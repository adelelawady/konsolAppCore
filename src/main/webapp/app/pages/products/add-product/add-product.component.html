<div class="modal" [class.show]="show" [class.d-block]="show" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          {{ (isEditMode ? 'products.modal.edit' : 'products.modal.add') | translate }}
        </h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <div class="row">
            <!-- Basic Information -->
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h4 class="card-title mb-0">{{ 'products.modal.sections.basic' | translate }}</h4>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <label class="form-label">{{ 'products.fields.name' | translate }}</label>
                    <input type="text" class="form-control" formControlName="name" />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">{{ 'products.fields.barcode' | translate }}</label>
                    <input type="text" class="form-control" formControlName="barcode" />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">{{ 'products.fields.category' | translate }}</label>
                    <input type="text" class="form-control" formControlName="category" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Pricing Information -->
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h4 class="card-title mb-0">{{ 'products.modal.sections.pricing' | translate }}</h4>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <label class="form-label">{{ 'products.fields.price' | translate }}</label>
                    <div class="input-group">
                      <input type="number" class="form-control" formControlName="price1" min="0" step="0.01" />
                      <span class="input-group-text">EGP</span>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">{{ 'products.fields.cost' | translate }}</label>
                    <div class="input-group">
                      <input type="number" class="form-control" formControlName="cost" min="0" step="0.01" />
                      <span class="input-group-text">EGP</span>
                    </div>
                  </div>
                  <div class="mb-3">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" role="switch" id="checkQty" formControlName="checkQty" />
                      <label class="form-check-label" for="checkQty">
                        {{ 'products.fields.checkQuantity' | translate }}
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Store Quantities and Units -->
            <div class="col-12 mt-3" *ngIf="isEditMode">
              <div class="card">
                <div class="card-header">
                  <ul class="nav nav-tabs card-header-tabs">
                    <li class="nav-item">
                      <a
                        class="nav-link"
                        [class.active]="activeTab === 'quantities'"
                        (click)="activeTab = 'quantities'"
                        href="javascript:void(0)"
                      >
                        <i class="bi bi-boxes me-1"></i>
                        {{ 'products.modal.sections.inventory' | translate }}
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" [class.active]="activeTab === 'units'" (click)="activeTab = 'units'" href="javascript:void(0)">
                        <i class="bi bi-rulers me-1"></i>
                        {{ 'products.modal.sections.units' | translate }}
                      </a>
                    </li>
                  </ul>
                </div>
                <div class="card-body">
                  <!-- Store Quantities Tab -->
                  <div [class.d-none]="activeTab !== 'quantities'" class="table-responsive">
                    <table class="table table-vcenter">
                      <thead>
                        <tr>
                          <th>{{ 'products.fields.store' | translate }}</th>
                          <th class="text-end" style="width: 200px">{{ 'products.fields.quantity' | translate }}</th>
                          <th class="w-1"></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let store of stores">
                          <td>{{ store.name }}</td>
                          <td>
                            <input
                              type="number"
                              class="form-control text-end"
                              [value]="storeItems[store.id!]"
                              (change)="updateStoreQuantity(store.id!, +$any($event.target).value)"
                              min="0"
                            />
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <!-- Item Units Tab -->
                  <div [class.d-none]="activeTab !== 'units'">
                    <div class="d-flex justify-content-end mb-3">
                      <button type="button" class="btn btn-primary btn-sm" (click)="addItemUnit()">
                        <i class="bi bi-plus-lg me-1"></i>
                        {{ 'products.modal.actions.addUnit' | translate }}
                      </button>
                    </div>
                    <div class="table-responsive">
                      <table class="table table-vcenter">
                        <thead>
                          <tr>
                            <th>{{ 'products.fields.unitName' | translate }}</th>
                            <th>{{ 'products.fields.pieces' | translate }}</th>
                            <th>{{ 'products.fields.price' | translate }}</th>
                            <th>{{ 'products.fields.cost' | translate }}</th>
                            <th>{{ 'products.fields.basic' | translate }}</th>
                            <th class="w-1"></th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let unit of itemUnits; let i = index">
                            <td>
                              <input type="text" class="form-control" [(ngModel)]="unit.name" [ngModelOptions]="{ standalone: true }" />
                            </td>
                            <td>
                              <input
                                type="number"
                                class="form-control"
                                [(ngModel)]="unit.pieces"
                                [ngModelOptions]="{ standalone: true }"
                                min="1"
                              />
                            </td>
                            <td>
                              <div class="input-group">
                                <input
                                  type="number"
                                  class="form-control"
                                  [(ngModel)]="unit.price"
                                  [ngModelOptions]="{ standalone: true }"
                                  min="0"
                                />
                                <span class="input-group-text">EGP</span>
                              </div>
                            </td>
                            <td>
                              <div class="input-group">
                                <input
                                  type="number"
                                  class="form-control"
                                  [(ngModel)]="unit.cost"
                                  [ngModelOptions]="{ standalone: true }"
                                  min="0"
                                />
                                <span class="input-group-text">EGP</span>
                              </div>
                            </td>
                            <td>
                              <div class="form-check form-switch">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  role="switch"
                                  [(ngModel)]="unit.basic"
                                  [ngModelOptions]="{ standalone: true }"
                                />
                              </div>
                            </td>

                            <td>
                              <button type="button" class="btn btn-icon btn-sm btn-ghost-danger" (click)="removeItemUnit(i)">
                                <fa-icon icon="times"></fa-icon>
                              </button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-link" (click)="closeModal()">
            {{ 'products.modal.actions.cancel' | translate }}
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="form.invalid || loading">
            <span class="spinner-border spinner-border-sm me-1" *ngIf="loading"></span>
            {{ (isEditMode ? 'products.modal.actions.update' : 'products.modal.actions.save') | translate }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
