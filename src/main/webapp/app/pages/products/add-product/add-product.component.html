<div class="modal" [class.show]="show" [class.d-block]="show" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          {{ (isEditMode ? 'products.modal.edit' : 'products.modal.add') | translate }}
        </h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <div class="row">
            <!-- Basic Information -->
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h4 class="card-title mb-0">{{ 'products.modal.sections.basic' | translate }}</h4>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <label class="form-label">{{ 'products.fields.name' | translate }}</label>
                    <input type="text" class="form-control" formControlName="name" />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">{{ 'products.fields.barcode' | translate }}</label>
                    <input type="text" class="form-control" formControlName="barcode" />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">{{ 'products.fields.category' | translate }}</label>
                    <input type="text" class="form-control" formControlName="category" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Pricing Information -->
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h4 class="card-title mb-0">{{ 'products.modal.sections.pricing' | translate }}</h4>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <label class="form-label">{{ 'products.fields.price' | translate }}</label>
                    <div class="input-group">
                      <input type="number" class="form-control" formControlName="price1" min="0" step="0.01" />
                      <span class="input-group-text">EGP</span>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">{{ 'products.fields.cost' | translate }}</label>
                    <div class="input-group">
                      <input type="number" class="form-control" formControlName="cost" min="0" step="0.01" />
                      <span class="input-group-text">EGP</span>
                    </div>
                  </div>
                  <div class="mb-3">
                    <div class="form-check form-switch">
                      <input type="checkbox" class="form-check-input" formControlName="checkQty" id="checkQty" />
                      <label class="form-check-label" for="checkQty">
                        {{ 'products.fields.checkQuantity' | translate }}
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Store Quantities -->
            <div class="col-12 mt-3">
              <div class="card">
                <div class="card-header">
                  <h4 class="card-title mb-0">{{ 'products.modal.sections.inventory' | translate }}</h4>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-vcenter">
                      <thead>
                        <tr>
                          <th>{{ 'products.fields.store' | translate }}</th>
                          <th class="text-end" style="width: 200px">{{ 'products.fields.quantity' | translate }}</th>
                          <th class="w-1"></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let store of stores">
                          <td>{{ store.name }}</td>
                          <td>
                            <input
                              type="number"
                              class="form-control text-end"
                              [value]="storeItems[store.id!]"
                              (change)="updateStoreQuantity(store.id!, +$any($event.target).value)"
                              min="0"
                              [disabled]="!isEditMode"
                            />
                          </td>
                          <td class="text-muted">
                            {{ store.id }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-link" (click)="closeModal()">
            {{ 'products.modal.actions.cancel' | translate }}
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="form.invalid || loading">
            <span class="spinner-border spinner-border-sm me-1" *ngIf="loading"></span>
            {{ (isEditMode ? 'products.modal.actions.update' : 'products.modal.actions.save') | translate }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
