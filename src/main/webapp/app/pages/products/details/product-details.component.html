<div class="container-fluid p-4">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Product Details -->
  <div *ngIf="product && !isLoading">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="mb-1">{{ product.name }}</h2>
        <p class="text-muted mb-0">{{ product.barcode }}</p>
      </div>
      <div>
        <button class="btn btn-outline-primary me-2" routerLink="/products">
          <fa-icon icon="arrow-left" class="me-2"></fa-icon>
          {{ 'product.details.backButton' | translate }}
        </button>
      </div>
    </div>

    <!-- Basic Information -->
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">{{ 'product.details.information.title' | translate }}</h5>
            <div class="mb-3">
              <label class="text-muted">{{ 'product.details.information.name' | translate }}:</label>
              <p class="mb-1">{{ product.name }}</p>
            </div>
            <div class="mb-3">
              <label class="text-muted">{{ 'product.details.information.code' | translate }}:</label>
              <p class="mb-1">{{ product.barcode }}</p>
            </div>
            <div class="mb-3">
              <label class="text-muted">{{ 'product.details.information.price' | translate }}:</label>
              <p class="mb-1">{{ product.price1 | number: '1.2-2' }}</p>
            </div>
            <div class="mb-3">
              <label class="text-muted">{{ 'product.details.information.cost' | translate }}:</label>
              <p class="mb-1">{{ product.cost | number: '1.2-2' }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Analysis Data -->
      <div class="col-md-6" *ngIf="productAnalysis">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">{{ 'product.details.analysis.title' | translate }}</h5>
            <div class="row g-3">
              <div class="col-sm-6">
                <div class="card bg-light">
                  <div class="card-body">
                    <h6 class="card-subtitle mb-2 text-muted">{{ 'product.details.analysis.totalSales' | translate }}</h6>
                    <h4 class="mb-0">{{ productAnalysis.totalSales | number: '1.2-2' }}</h4>
                  </div>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="card bg-light">
                  <div class="card-body">
                    <h6 class="card-subtitle mb-2 text-muted">{{ 'product.details.analysis.netSales' | translate }}</h6>
                    <h4 class="mb-0">{{ productAnalysis.netSales | number: '1.2-2' }}</h4>
                  </div>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="card bg-light">
                  <div class="card-body">
                    <h6 class="card-subtitle mb-2 text-muted">{{ 'product.details.analysis.totalProfit' | translate }}</h6>
                    <h4 class="mb-0">{{ productAnalysis.totalProfit | number: '1.2-2' }}</h4>
                  </div>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="card bg-light">
                  <div class="card-body">
                    <h6 class="card-subtitle mb-2 text-muted">{{ 'product.details.analysis.totalDiscounts' | translate }}</h6>
                    <h4 class="mb-0">{{ productAnalysis.totalDiscount | number: '1.2-2' }}</h4>
                  </div>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="card bg-light">
                  <div class="card-body">
                    <h6 class="card-subtitle mb-2 text-muted">{{ 'product.details.analysis.quantityInOut' | translate }}</h6>
                    <h4 class="mb-0">{{ productAnalysis.totalQtyIn | number }} / {{ productAnalysis.totalQtyOut | number }}</h4>
                  </div>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="card bg-light">
                  <div class="card-body">
                    <h6 class="card-subtitle mb-2 text-muted">{{ 'product.details.analysis.totalCost' | translate }}</h6>
                    <h4 class="mb-0">{{ productAnalysis.totalCost | number: '1.2-2' }}</h4>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chart Section -->
    <div class="row mt-4">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h5 class="card-title mb-0">{{ 'product.details.chart.title' | translate }}</h5>
              <div class="btn-group">
                <button
                  *ngFor="let range of dateRanges"
                  class="btn btn-outline-primary"
                  [class.active]="selectedRange === range.value"
                  (click)="onRangeChange(range.value)"
                >
                  {{ 'product.details.chart.periods.' + range.value | translate }}
                </button>
              </div>
            </div>

            <!-- Chart content -->
            <div *ngIf="loadingChart" class="text-center py-5">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>

            <div *ngIf="!loadingChart && chartData" style="height: 500px; position: relative">
              <canvas #chartCanvas></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
