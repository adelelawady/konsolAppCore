<div class="container-xl">
  <div class="row">
    <!-- POS Table Section -->
    <div class="col-lg-9">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">نظام نقاط البيع</h2>
        </div>
        <div class="card-body">
          <!-- Search and Add Section -->
          <div class="d-flex flex-column flex-md-row gap-3 mb-3">
            <div class="search-container flex-grow-1">
              <div class="input-icon">
                <span class="input-icon-addon">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24">
                    <path
                      d="M10 4a6 6 0 1 0 0 12 6 6 0 0 0 0-12zm-8 6a8 8 0 1 1 14.32 4.906l5.387 5.387a1 1 0 0 1-1.414 1.414l-5.387-5.387A8 8 0 0 1 2 10z"
                    />
                  </svg>
                </span>
                <input type="text" class="form-control" placeholder="بحث عن منتج..." />
              </div>
            </div>
            <div class="d-flex gap-2 flex-wrap">
              <input type="number" class="form-control w-auto" placeholder="الكمية" />
              <input type="number" class="form-control w-auto" placeholder="السعر" />
              <button class="btn btn-outline-primary">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M12 4v16m-8-8h16" />
                </svg>
                إضافة منتج
              </button>
            </div>
          </div>

          <!-- Order Summary -->
          <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded mb-3">
            <div class="d-flex gap-3">
              <span>الكمية: {{ totalQuantity | number: '1.3-3' }}</span>
              <span>السعر: {{ currentPrice | number: '1.3-3' }} ر.س</span>
            </div>
            <div class="d-flex align-items-center gap-2">
              <span>حساب واحد</span>
              <button class="btn btn-icon btn-outline-secondary">-</button>
              <button class="btn btn-icon btn-outline-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M12 15V3m0 12l-4-4m4 4l4-4M17 21H7a2 2 0 0 1-2-2v-2" />
                </svg>
              </button>
            </div>
          </div>

          <!-- Items Table -->
          <div class="table-responsive">
            <table class="table table-vcenter table-bordered">
              <thead>
                <tr>
                  <th>رقم</th>
                  <th>اسم</th>
                  <th>وحدة</th>
                  <th>سعر الوحدة</th>
                  <th>كمية</th>
                  <th>اجمالي السعر</th>
                  <th>خصم</th>
                  <th>صافي</th>
                  <th>اجراءات</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of saleItems; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td>{{ item.name }}</td>
                  <td>{{ item.unit }}</td>
                  <td>{{ item.unitPrice | number: '1.2-2' }} ر.س</td>
                  <td>
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      [(ngModel)]="item.quantity"
                      (change)="updateQuantity(i, item.quantity)"
                    />
                  </td>
                  <td>{{ item.totalPrice | number: '1.2-2' }} ر.س</td>
                  <td>
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      [(ngModel)]="item.discount"
                      (change)="updateDiscount(i, item.discount)"
                    />
                  </td>
                  <td>{{ item.netPrice | number: '1.2-2' }} ر.س</td>
                  <td>
                    <div class="btn-list">
                      <button class="btn btn-icon btn-ghost-primary" (click)="editItem(i)">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24">
                          <path d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 1 1 3.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                        </svg>
                      </button>
                      <button class="btn btn-icon btn-ghost-danger" (click)="removeItem(i)">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24">
                          <path
                            d="M19 7l-.867 12.142A2 2 0 0 1 16.138 21H7.862a2 2 0 0 1-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v3M4 7h16"
                          />
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- User Panel Section -->
    <div class="col-lg-3">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">بيع</h3>
        </div>
        <div class="card-body">
          <!-- User Info -->
          <div class="d-flex align-items-center mb-3">
            <span class="avatar avatar-md me-3">
              <img src="/assets/images/placeholder.svg" alt="" />
            </span>
            <div>
              <div class="font-weight-medium">{{ userName }}</div>
              <div class="text-muted small">{{ currentDate | date: 'HH:mm dd/MM/yyyy' }}</div>
            </div>
            <div class="ms-auto">
              <div class="text-muted">رقم الفاتورة: {{ invoiceNumber }}</div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="d-flex gap-2 mb-3">
            <button class="btn btn-outline-primary w-100">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="24" height="24" viewBox="0 0 24 24">
                <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 0 0 4.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 0 1-15.357-2m15.357 2H15" />
              </svg>
              تعديل
            </button>
            <button class="btn btn-outline-danger w-100">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="24" height="24" viewBox="0 0 24 24">
                <path
                  d="M19 7l-.867 12.142A2 2 0 0 1 16.138 21H7.862a2 2 0 0 1-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v3M4 7h16"
                />
              </svg>
              حذف
            </button>
          </div>

          <!-- Store Selection -->
          <div class="mb-3">
            <label class="form-label">المخزن</label>
            <select class="form-select" [(ngModel)]="selectedStore">
              <option value="">اختر المخزن</option>
              <option value="store1">المخزن الرئيسي</option>
              <option value="store2">مخزن الفرع 1</option>
              <option value="store3">مخزن الفرع 2</option>
            </select>
          </div>

          <!-- Bank Selection -->
          <div class="mb-3">
            <label class="form-label">البنك</label>
            <select class="form-select" [(ngModel)]="selectedBank">
              <option value="">اختر البنك</option>
              <option value="bank1">البنك الأهلي</option>
              <option value="bank2">بنك الراجحي</option>
              <option value="bank3">بنك الرياض</option>
            </select>
          </div>

          <!-- Discount Input -->
          <div class="mb-3">
            <label class="form-label">خصم على الفاتورة</label>
            <div class="input-group">
              <input type="number" class="form-control" [(ngModel)]="invoiceDiscount" (change)="updateTotals()" />
              <span class="input-group-text">ر.س</span>
            </div>
          </div>

          <!-- Totals Summary -->
          <div class="card bg-primary-subtle">
            <div class="card-body">
              <div class="d-flex justify-content-between mb-2">
                <span>الإجمالي قبل الخصم:</span>
                <span>{{ totalAmount | number: '1.2-2' }} ر.س</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>الخصم:</span>
                <span>{{ totalDiscount | number: '1.2-2' }} ر.س</span>
              </div>
              <div class="d-flex justify-content-between fw-bold">
                <span>الإجمالي النهائي:</span>
                <span>{{ netTotal | number: '1.2-2' }} ر.س</span>
              </div>
            </div>
          </div>

          <!-- Save Button -->
          <button class="btn btn-primary w-100 mt-3" (click)="saveInvoice()">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="24" height="24" viewBox="0 0 24 24">
              <path d="M5 12l5 5l10 -10" />
            </svg>
            حفظ الفاتورة
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
