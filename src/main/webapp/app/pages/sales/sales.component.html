<div class="container-fluid p-3">
  <div class="row g-3">
    <!-- POS Table Section -->
    <div class="col-lg-9">
      <div class="card">
        <div class="card-header">
          <div class="d-flex justify-content-between align-items-center">
            <h3 class="card-title m-0">نظام نقاط البيع</h3>
          </div>
        </div>
        <div class="card-body p-0">
          <!-- Search and Add Section -->
          <div class="p-3 bg-light border-bottom">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="input-icon">
                  <span class="input-icon-addon">
                    <i class="ti ti-search"></i>
                  </span>
                  <input type="text" class="form-control" placeholder="بحث عن منتج..." />
                </div>
              </div>
              <div class="col-md-6">
                <div class="d-flex gap-2">
                  <input type="number" class="form-control" placeholder="الكمية" />
                  <input type="number" class="form-control" placeholder="السعر" />
                  <button class="btn btn-primary">
                    <i class="ti ti-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Order Summary -->
          <div class="p-3 bg-light border-bottom">
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex gap-4">
                <div class="status-indicator">
                  <span class="status-indicator-title">الكمية</span>
                  <span class="status-indicator-value">{{ totalQuantity | number: '1.3-3' }}</span>
                </div>
                <div class="status-indicator">
                  <span class="status-indicator-title">السعر</span>
                  <span class="status-indicator-value">{{ currentPrice | number: '1.3-3' }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Resizable Data Table -->
          <div class="table-responsive" #tableContainer>
            <app-data-table
              [columns]="tableColumns"
              [data]="saleItems"
              [loading]="loading"
              [showPagination]="false"
              [showSearch]="false"
              [emptyMessage]="'لا توجد منتجات'"
              (edit)="onTableEdit($event)"
              (delete)="onTableDelete($event)"
              (valueChange)="onTableValueChange($event)"
            >
            </app-data-table>
          </div>
        </div>
      </div>
    </div>

    <!-- Keep existing user panel code -->
    <div class="col-lg-3">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">بيع</h3>
        </div>
        <div class="card-body">
          <!-- User Info -->
          <div class="d-flex align-items-center mb-3 pb-3 border-bottom">
            <span class="avatar avatar-lg me-3">
              <img src="/assets/images/placeholder.svg" alt="User Avatar" />
            </span>
            <div class="flex-fill">
              <div class="font-weight-medium">{{ userName }}</div>
              <div class="text-muted small">{{ currentDate | date: 'HH:mm dd/MM/yyyy' }}</div>
            </div>
            <div class="ms-auto text-end">
              <div class="text-muted small">رقم الفاتورة</div>
              <div class="font-weight-medium">{{ invoiceNumber }}</div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="d-flex gap-2 mb-3">
            <button class="btn btn-outline-primary w-100">
              <i class="ti ti-refresh me-1"></i>
              تعديل
            </button>
            <button class="btn btn-outline-danger w-100">
              <i class="ti ti-trash me-1"></i>
              حذف
            </button>
          </div>

          <!-- Store Selection -->
          <div class="mb-3">
            <label class="form-label">المخزن</label>
            <select class="form-select" [(ngModel)]="selectedStore">
              <option value="">اختر المخزن</option>
              <option value="store1">المخزن الرئيسي</option>
              <option value="store2">مخزن الفرع 1</option>
              <option value="store3">مخزن الفرع 2</option>
            </select>
          </div>

          <!-- Bank Selection -->
          <div class="mb-3">
            <label class="form-label">البنك</label>
            <select class="form-select" [(ngModel)]="selectedBank">
              <option value="">اختر البنك</option>
              <option value="bank1">البنك الأهلي</option>
              <option value="bank2">بنك الراجحي</option>
              <option value="bank3">بنك الرياض</option>
            </select>
          </div>

          <!-- Invoice Discount -->
          <div class="mb-4">
            <label class="form-label">خصم على الفاتورة</label>
            <div class="input-group">
              <input type="number" class="form-control" [(ngModel)]="invoiceDiscount" (change)="updateTotals()" min="0" step="0.01" />
              <span class="input-group-text">ر.س</span>
            </div>
          </div>

          <!-- Totals Summary -->
          <div class="card bg-primary-subtle mb-3">
            <div class="card-body">
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted">الإجمالي قبل الخصم:</span>
                <span class="font-weight-medium">{{ totalAmount | number: '1.2-2' }} ر.س</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted">الخصم:</span>
                <span class="text-danger">{{ totalDiscount | number: '1.2-2' }} ر.س</span>
              </div>
              <div class="d-flex justify-content-between">
                <span class="font-weight-bold">الإجمالي النهائي:</span>
                <span class="font-weight-bold text-primary h4 mb-0">{{ netTotal | number: '1.2-2' }} ر.س</span>
              </div>
            </div>
          </div>

          <!-- Save Button -->
          <button class="btn btn-primary w-100" (click)="saveInvoice()">
            <i class="ti ti-device-floppy me-1"></i>
            حفظ الفاتورة
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
